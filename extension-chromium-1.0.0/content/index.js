import { r as r$1 } from '../chunks/browser-polyfill-7db03db5.js';

const t=document.createElement("iframe");function r(e,r){var n;null===(n=t.contentWindow)||void 0===n||n.postMessage(JSON.stringify({event:e,ts:Date.now(),message:r}),"*");}t.allow="autoplay",t.id="yard-frame",t.style.display="none",t.src=r$1.runtime.getURL("audio/audio.html"),document.body.appendChild(t);let n=!1;setInterval((()=>{const e=document.querySelector("#hudson-wrapper video");if(e&&!n){const s=function(){var e;let t=null===(e=document.querySelector(".title-field"))||void 0===e?void 0:e.textContent;if(!t)return;return t=t.toLowerCase(),o.find((e=>e.title.startsWith(t+" (")))}();s&&(n=!0,r("loaded",s),t.style.display="block",function(e){e.addEventListener("play",(()=>{r("play",{time:e.currentTime});})),e.addEventListener("pause",(()=>{r("pause");})),e.addEventListener("timeupdate",(()=>{r("timeupdate",{time:e.currentTime});}));}(e));}else !e&&n&&(r("unloaded"),t.style.display="none",n=!1);}),250),r$1.storage.sync.get("rss").then((e=>{e.rss&&s(e.rss);})),r$1.storage.onChanged.addListener((e=>{e.rss&&s(e.rss.newValue);}));let o=[];async function s(e){var t,r,n;const s=new URL(e).searchParams.get("auth");if(!s)throw new Error("Invalid RSS URL");const i=await fetch("https://dcom-worker.mogul-moves.workers.dev",{headers:{Authorization:s}}).then((e=>e.text())),l=(new DOMParser).parseFromString(i,"text/xml").querySelectorAll("item");o=[];for(let e=0;e<l.length;e++){const s=l[e],i=null===(t=s.querySelector("title"))||void 0===t?void 0:t.textContent,a=null===(r=s.querySelector("description"))||void 0===r?void 0:r.textContent,d=null===(n=s.querySelector("enclosure"))||void 0===n?void 0:n.getAttribute("url");i&&a&&d&&o.push({title:i.toLowerCase(),description:a,audioUrl:d});}return o}
